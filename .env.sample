# =============================================================================
# BAASIX Environment Configuration
# =============================================================================
# Copy this file to .env and update the values for your environment.
# Lines starting with # are comments. Uncomment variables to enable them.

# =============================================================================
# SERVER
# =============================================================================

# Port number the server will listen on
PORT=8056

# Log level: fatal | error | warn | info | debug | trace | silent
# Use 'debug' or 'trace' to enable verbose logging
LOG_LEVEL=info

# Include stack traces for warnings (useful for debugging)
# LOG_WARN_STACK=false

# Enable test mode (disables certain features for testing)
TEST_MODE=false

# Disable automatic expired session cleanup (useful for testing or custom cleanup)
# DISABLE_SESSION_CLEANUP=false

# Maximum number of requests allowed per interval
RATE_LIMIT=250

# Rate limit interval in milliseconds (5 seconds = 5000ms)
RATE_LIMIT_INTERVAL=5000

# Rate limit by user ID instead of IP (useful when multiple users share same network)
# RATE_LIMIT_BY_USER=true

# Require email verification before user can login
REQUIRE_EMAIL_VERIFICATION=false

# =============================================================================
# SOCKET.IO (Real-time)
# =============================================================================

# Enable/disable Socket.IO for real-time updates
SOCKET_ENABLED=true

# Collections to exclude from real-time broadcasts (comma-separated)
SOCKET_EXCLUDE_COLLECTIONS="baasix_Roles,baasix_Permission,baasix_AuditLog,baasix_EmailLog"

# Allowed origins for Socket.IO CORS (comma-separated)
SOCKET_CORS_ENABLED_ORIGINS="http://localhost:3000,http://localhost:8056"

# Socket.IO endpoint path
SOCKET_PATH=/realtime

# Enable Redis adapter for Socket.IO (required for multi-instance deployments)
SOCKET_REDIS_ENABLED=false

# Redis URL for Socket.IO adapter
SOCKET_REDIS_URL=redis://localhost:6379

# Redis key prefix for Socket.IO
SOCKET_REDIS_KEY=socket.io

# =============================================================================
# DATABASE (PostgreSQL)
# =============================================================================

# PostgreSQL connection URL
DATABASE_URL="postgresql://username:password@localhost:5432/baasix"

# Number of connection retry attempts on startup
DATABASE_MAX_RETRY=3

# Delay between retry attempts in milliseconds
DATABASE_RETRY_INTERVAL=5000

# Enable PostGIS extension for geospatial queries
DATABASE_POSTGIS=true

# Path to SSL certificate file (set to false to disable SSL)
DATABASE_SSL_CERTIFICATE=false

# Reject unauthorized SSL connections
DATABASE_SSL_REJECT_UNAUTHORIZED=false

# Log SQL queries to console (requires LOG_LEVEL=debug to see output)
DATABASE_LOGGING=false

# Transaction timeout in milliseconds
TRANSACTION_TIMEOUT_MS=60000

# Maximum number of connections in the pool
DATABASE_POOL_MAX=20

# Maximum time (ms) to wait when acquiring a connection from pool
DATABASE_POOL_ACQUIRE=30000

# Time (ms) after which idle connections are closed
DATABASE_POOL_IDLE=10000

# Maximum lifetime (ms) of a connection before it's closed and recreated
DATABASE_POOL_EVICT=60000

# --- Read Replicas (Optional) ---
# Enable read replicas for read scaling
DATABASE_READ_REPLICA_ENABLED=false

# Comma-separated list of read replica URLs
DATABASE_READ_REPLICA_URLS="postgresql://username:password@localhost:5432/baasix_r1,postgresql://username:password@localhost:5432/baasix_r2"

# Read replica pool settings
DATABASE_READ_REPLICA_POOL_MAX=20
DATABASE_READ_REPLICA_POOL_ACQUIRE=30000
DATABASE_READ_REPLICA_POOL_IDLE=10000
DATABASE_READ_REPLICA_POOL_EVICT=60000

# =============================================================================
# CACHE
# =============================================================================

# Enable/disable caching
CACHE_ENABLED=true

# Cache adapter: memory | redis | upstash
# - memory: In-memory cache (single instance only)
# - redis: Redis/Valkey (recommended for production/multi-instance)
# - upstash: Upstash Redis REST API
CACHE_ADAPTER=memory

# Sync interval in seconds for L1â†”L2 cache synchronization
# (applies to roles, permissions, and settings caches)
CACHE_SYNC_INTERVAL=5

# Cache strategy: explicit | all
# - explicit: Opt-in caching per query with .$withCache()
# - all: Cache all queries automatically
CACHE_STRATEGY=explicit

# Default TTL (Time To Live) in seconds
CACHE_TTL=300

# Maximum cache size in GB (for memory adapter only)
CACHE_SIZE_GB=1

# Redis connection URL (for redis adapter)
# CACHE_REDIS_URL=redis://localhost:6379

# Upstash Redis REST credentials (for upstash adapter)
# UPSTASH_REDIS_REST_URL=https://your-redis.upstash.io
# UPSTASH_REDIS_REST_TOKEN=your-upstash-token

# =============================================================================
# JWT / AUTHENTICATION
# =============================================================================

# Secret key for JWT signing (min 32 characters recommended)
SECRET_KEY=your-secret-key-min-32-chars-change-this

# Access token expiration time in seconds (default: 1 year = 31536000)
ACCESS_TOKEN_EXPIRES_IN=31536000

# =============================================================================
# MULTI-TENANCY
# =============================================================================

# Enable multi-tenant mode
MULTI_TENANT=false

# Allow public user registration
PUBLIC_REGISTRATION=true

# Default role assigned to new users (when MULTI_TENANT=false)
DEFAULT_ROLE_REGISTERED=user

# Allowed roles for public registration (when MULTI_TENANT=true, comma-separated)
ALLOWED_ROLES_MULTI_TENANT="tenant_owner,tenant_admin,tenant_user"

# Tables that are shared across tenants (comma-separated)
TENANT_IGNORED_TABLES="country,currency"

# =============================================================================
# FILE STORAGE
# =============================================================================

# Enable asset proxy for secure file access
# ASSET_PROXY_ENABLED=true

# File types to serve through secure proxy (comma-separated: video,audio,image,pdf)
# ASSET_SECURE_PROXY_URLS=video,image,pdf

# Enabled storage services (comma-separated)
STORAGE_SERVICES_ENABLED="LOCAL"

# Default storage service to use
STORAGE_DEFAULT_SERVICE="LOCAL"

# Temporary file storage path
STORAGE_TEMP_PATH="../.temp"

# --- Local Storage ---
LOCAL_STORAGE_DRIVER=LOCAL
LOCAL_STORAGE_PATH="../uploads"

# --- S3-Compatible Storage (e.g., AWS S3, DigitalOcean Spaces, MinIO) ---
# Uncomment and configure to enable S3 storage
# SPACES_STORAGE_DRIVER=S3
# SPACES_STORAGE_ENDPOINT=s3.amazonaws.com
# SPACES_STORAGE_BUCKET=your-bucket-name
# SPACES_STORAGE_ACCESS_KEY_ID=your-access-key
# SPACES_STORAGE_SECRET_ACCESS_KEY=your-secret-key
# SPACES_STORAGE_REGION=us-east-1

# =============================================================================
# EMAIL (SMTP)
# =============================================================================

# Enabled mail senders (comma-separated sender names)
# MAIL_SENDERS_ENABLED=GMAIL,SENDGRID

# Default sender to use
# MAIL_DEFAULT_SENDER=SENDGRID

# --- Gmail SMTP Configuration ---
# GMAIL_SMTP_HOST=smtp.gmail.com
# GMAIL_SMTP_PORT=587
# GMAIL_SMTP_SECURE=false
# GMAIL_SMTP_USER=your_gmail_username
# GMAIL_SMTP_PASS=your_gmail_app_password
# GMAIL_FROM_ADDRESS="Your Name <your_email@gmail.com>"

# --- SendGrid/Generic SMTP Configuration ---
# SENDGRID_SMTP_HOST=smtp.sendgrid.net
# SENDGRID_SMTP_PORT=587
# SENDGRID_SMTP_SECURE=false
# SENDGRID_SMTP_USER=apikey
# SENDGRID_SMTP_PASS=your_sendgrid_api_key
# SENDGRID_FROM_ADDRESS="Your App <noreply@yourdomain.com>"

# =============================================================================
# CORS (Cross-Origin Resource Sharing)
# =============================================================================

# Allowed origins for CORS requests (comma-separated)
AUTH_CORS_ALLOWED_ORIGINS="http://localhost:3000,http://localhost:8056"

# Allow any port for the specified origins
AUTH_CORS_ALLOW_ANY_PORT=true

# Allow credentials (cookies, authorization headers) in CORS requests
AUTH_CORS_CREDENTIALS=true

# =============================================================================
# COOKIES
# =============================================================================

# HttpOnly flag - prevents JavaScript access to cookies (recommended: true)
AUTH_COOKIE_HTTP_ONLY=true

# Secure flag - only send cookies over HTTPS (set true in production)
AUTH_COOKIE_SECURE=false

# SameSite policy: strict | lax | none
AUTH_COOKIE_SAME_SITE=lax

# Cookie path
AUTH_COOKIE_PATH=/

# Cookie domain (uncomment for cross-subdomain cookies)
# AUTH_COOKIE_DOMAIN=.yourdomain.com

# =============================================================================
# OAUTH / SOCIAL AUTHENTICATION
# =============================================================================

# Enabled auth services (comma-separated): LOCAL,GOOGLE,FACEBOOK,APPLE,GITHUB
AUTH_SERVICES_ENABLED=LOCAL

# Allowed redirect URLs after OAuth (comma-separated)
AUTH_APP_URL="http://localhost:3000,http://localhost:8056"

# --- Google OAuth ---
# GOOGLE_CLIENT_ID=your_google_client_id
# GOOGLE_CLIENT_SECRET=your_google_client_secret

# --- Facebook OAuth ---
# FACEBOOK_CLIENT_ID=your_facebook_client_id
# FACEBOOK_CLIENT_SECRET=your_facebook_client_secret

# --- Apple Sign In ---
# APPLE_CLIENT_ID=your_apple_client_id
# APPLE_CLIENT_SECRET=your_apple_client_secret
# APPLE_TEAM_ID=your_apple_team_id
# APPLE_KEY_ID=your_apple_key_id
# APPLE_PRIVATE_KEY=your_apple_private_key

# --- GitHub OAuth ---
# GITHUB_CLIENT_ID=your_github_client_id
# GITHUB_CLIENT_SECRET=your_github_client_secret

# =============================================================================
# OPENAPI / SWAGGER
# =============================================================================

# Enable OpenAPI documentation endpoint (/openapi)
OPENAPI_ENABLED=true

# Include auth endpoints in OpenAPI docs
OPENAPI_INCLUDE_AUTH=true

# Include multi-tenant endpoints in OpenAPI docs
OPENAPI_INCLUDE_MULTI_TENANT=true

# Include schema management endpoints in OpenAPI docs
OPENAPI_INCLUDE_SCHEMA=true

# Include permission management endpoints in OpenAPI docs
OPENAPI_INCLUDE_PERMISSIONS=true

# Include settings endpoints in OpenAPI docs
OPENAPI_INCLUDE_SETTINGS=true

# Include utility endpoints in OpenAPI docs
OPENAPI_INCLUDE_UTILS=true

# Include notification endpoints in OpenAPI docs
OPENAPI_INCLUDE_NOTIFICATIONS=true


# =============================================================================
# SCHEMA ACCESS
# =============================================================================

# Allow public access to /schemas endpoints (without authentication)
# Default is true (public) for backwards compatibility and CLI type generation
# Set to 'false' for production to require permission on baasix_SchemaDefinition collection
# Admins always have access regardless of this setting
SCHEMAS_PUBLIC=false

# =============================================================================
# TASK QUEUE / BACKGROUND JOBS
# =============================================================================

# Enable the background task service
TASK_SERVICE_ENABLED=false

# Interval to refresh task list from database (in seconds)
TASK_LIST_REFRESH_INTERVAL=1800

# Time to wait for running tasks during shutdown (in seconds)
TASK_SHUTDOWN_WAIT_TIME=60

# Enable Redis for distributed task locking (required for multi-instance deployments)
# When enabled, only one instance will process tasks at a time
TASK_REDIS_ENABLED=false

# Redis URL for task service distributed locking
# Can be the same as SOCKET_REDIS_URL or a separate Redis instance
TASK_REDIS_URL=redis://localhost:6379

# =============================================================================
# MIGRATIONS
# =============================================================================

# Automatically run pending migrations on startup
MIGRATIONS_AUTO_RUN=false

# Custom directory for migration files (default: ./migrations)
# MIGRATIONS_DIR=/path/to/migrations

# Baseline version for Sequelize-to-Drizzle upgrade
# Set when upgrading from Sequelize version to skip migrations up to this version
# MIGRATIONS_UPGRADE_BASELINE=0.1.0
